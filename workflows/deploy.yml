# ==========================================
# 1 METADANE WORKFLOW'U
# ==========================================

name: Deploy React App
# ‚Ü≥ Nazwa workflow'u widoczna na GitHub Actions tab
# ‚Ü≥ Pojawia siƒô jako "Deploy React App" w historii


# ==========================================
# 2 TRIGGERY - Kiedy siƒô uruchomiƒá?
# ==========================================

on:
  push:
    branches: [ main ]
    # ‚Ü≥ Uruchom workflow gdy:
    #   ‚Ä¢ Co≈õ zostanie push'niƒôte (git push)
    #   ‚Ä¢ Na branchu o nazwie 'main'
    #   ‚Ä¢ Czyli KA≈ªDY commit na main = automatyczny deploy
    
    # üí° Je≈õli masz brancha 'master' zamiast 'main':
    # branches: [ master ]

  workflow_dispatch:
    # ‚Ü≥ Dodatkowy trigger - mo≈ºliwo≈õƒá rƒôcznego uruchomienia
    # ‚Ü≥ Pojawia siƒô przycisk "Run workflow" w GitHub Actions
    # ‚Ü≥ Przydatne gdy chcesz zdeployowaƒá bez commitowania


# ==========================================
# 3 UPRAWNIENIA - Co workflow mo≈ºe robiƒá?
# ==========================================

permissions:
  contents: read
    # ‚Ü≥ Zezw√≥l odczytaƒá zawarto≈õƒá repozytorium
    # ‚Ü≥ Potrzebne do: git checkout (pobierz kod)

  pages: write
    # ‚Ü≥ Zezw√≥l pisaƒá do GitHub Pages
    # ‚Ü≥ Potrzebne do: deployment aplikacji na GitHub Pages

  id-token: write
    # ‚Ü≥ Zezw√≥l u≈ºywaƒá OpenID Connect token'√≥w
    # ‚Ü≥ Potrzebne do: bezpieczna autoryzacja w GitHub Pages
    # ‚Ü≥ To jest nowsza, bardziej bezpieczna metoda ni≈º GitHub token


# ==========================================
# 4 JOBS - Co dok≈Çadnie robiƒá?
# ==========================================

jobs:
  build:
    # ‚Ü≥ Nazwa joba (mo≈ºesz mieƒá wiele: build, test, deploy, etc.)
    
    runs-on: ubuntu-latest
    # ‚Ü≥ Na jakim systemie operacyjnym uruchomiƒá?
    # ‚Ü≥ ubuntu-latest = najnowsza wersja Ubuntu (Linux)
    # ‚Ü≥ Opcje: ubuntu-latest, macos-latest, windows-latest


    # ==========================================
    # 5 KROKI - Instrukcje wykonania
    # ==========================================

    steps:

      # KROK 1: Pobierz kod z repozytorium
      - uses: actions/checkout@v4
        # ‚Ü≥ U≈ºyj gotowej akcji 'checkout' (wersja 4)
        # ‚Ü≥ Akcja = gotowy skrypt od GitHub
        # ‚Ü≥ Co robi: git clone https://github.com/twoja-nazwa/repo.git
        # ‚Ü≥ Pobiera ca≈Çy kod do workflow runner'a


      # KROK 2: Zainstaluj Node.js
      - uses: actions/setup-node@v4
        # ‚Ü≥ U≈ºyj akcji do zainstalowania Node.js
        
        with:
          node-version: '18'
          # ‚Ü≥ Parametry dla akcji setup-node
          # ‚Ü≥ Zainstaluj Node.js wersja 18.x
          # ‚Ü≥ Opcje: '16', '18', '20', '21', itp.


      # KROK 3: Zainstaluj zale≈ºno≈õci
      - run: npm ci
        # ‚Ü≥ Uruchom komendƒô: npm ci
        # ‚Ü≥ ci = "Clean Install" (bardziej powtarzalny ni≈º npm install)
        # ‚Ü≥ Instaluje zale≈ºno≈õci z package-lock.json
        # ‚Ü≥ Co siƒô dzieje:
        #   1. Czyta package.json i package-lock.json
        #   2. Pobiera dok≈Çadnie te same wersje pakiet√≥w
        #   3. Zainstaluje w node_modules/
        #   4. Gotowaaplikacja do builda


      # KROK 4: Zbuduj aplikacjƒô
      - run: npm run build
        # ‚Ü≥ Uruchom komendƒô: npm run build
        # ‚Ü≥ Definicja w package.json: "build": "tsc && vite build"
        # ‚Ü≥ Co siƒô dzieje:
        #   1. TypeScript kompiluje .tsx ‚Üí .js
        #   2. Vite pakuje i minifikuje kod
        #   3. Tworzy folder 'dist/' z wersjƒÖ produkcyjnƒÖ
        #   4. dist/ zawiera: index.html, assets/ (JS, CSS)
        # ‚Ü≥ Folder dist/ jest gotowy do deployment'u


      # KROK 5: Upload artefaktu (wynik builda)
      - uses: actions/upload-pages-artifact@v3
        # ‚Ü≥ U≈ºyj akcji do uploadu do GitHub Pages
        # ‚Ü≥ Akcja przygotowuje folder do deployment'u
        
        with:
          path: './dist'
          # ‚Ü≥ Parametry: ≈õcie≈ºka do folderu do uploadu
          # ‚Ü≥ './dist' = folder wygenerowany przez: npm run build
          # ‚Ü≥ Zawiera: HTML, CSS, JS gotowy do serowania


      # KROK 6: Deploy na GitHub Pages
      - uses: actions/deploy-pages@v3
        # ‚Ü≥ U≈ºyj akcji do deployment'u na GitHub Pages
        # ‚Ü≥ Co robi:
        #   1. Bierze uploaded artefakt (dist/)
        #   2. Publikuje na: https://twoja-nazwa.github.io/repo-name/
        #   3. GitHub Pages seruje pliki HTML/CSS/JS
        # ‚Ü≥ Aplikacja jest teraz live! 


# ==========================================
#  PRZEP≈ÅYW WORKFLOW'U
# ==========================================

# Schemat chronologiczny:
#
# 1. Co≈õ push'ujesz na main branch
#    ‚Üì
# 2. GitHub Actions siƒô uruchamia
#    ‚Üì
# 3. Pobiera kod z repo (checkout)
#    ‚Üì
# 4. Instaluje Node.js v18
#    ‚Üì
# 5. npm ci (instalacja zale≈ºno≈õci)
#    ‚Üì
# 6. npm run build (kompilacja TypeScript + Vite bundling)
#    ‚Üì
# 7. Upload folder dist/
#    ‚Üì
# 8. Deploy na GitHub Pages
#    ‚Üì
# 9. Aplikacja dostƒôpna na: https://user.github.io/repo-name/
#    ‚Üì
#    KONIEC - workflow zako≈Ñczony!


# ==========================================
# KONFIGURACJA DLA TWOJEGO PROJEKTU
# ==========================================

# Czego mo≈ºe byƒá potrzeba zmieniƒá?

# 1. Je≈õli masz brancha 'master' zamiast 'main':
branches: [ master ]

# 2. Je≈õli u≈ºywasz innej wersji Node.js:
node-version: '20'  # zamiast '18'

# 3. Je≈õli zamiast npm u≈ºywasz yarn:
# - run: yarn install
# - run: yarn build

# 4. Je≈õli zamiast npm ci u≈ºywasz:
# - run: npm install  # mniej powtarzalny, ale mo≈ºliwy


# ==========================================
# WA≈ªNE: Konfiguracja vite.config.ts
# ==========================================

# ≈ªeby aplikacja dzia≈Ça≈Ça na GitHub Pages, musisz mieƒá:
#
# vite.config.ts:
# export default defineConfig({
#   plugins: [react()],
#   base: '/react-ts-starter/', // NAZWA REPOZYTORIUM!
# })
#
# Je≈õli nie ustawisz 'base', linki bƒôdƒÖ siƒô ≈Çamaƒá!


# ==========================================
# ZMIENNE ≈öRODOWISKOWE (opcjonalnie)
# ==========================================

# Je≈õli potrzebujesz zmiennych env w CI/CD:
#
# env:
#   CI: true          # Dla Create React App
#   NODE_ENV: production
#
# steps:
#   - run: echo ${{ env.CI }}


# ==========================================
# SECRETS (je≈õli potrzebujesz hase≈Ç/token√≥w)
# ==========================================

# Je≈õli masz API keys, hase≈Ça, tokeny:
#
# 1. Id≈∫ do: Settings ‚Üí Secrets and variables ‚Üí Actions
# 2. Kliknij "New repository secret"
# 3. Dodaj: MY_SECRET_KEY = "warto≈õƒá"
#
# W workflow:
# - run: echo ${{ secrets.MY_SECRET_KEY }}


# ==========================================
# SPRAWDZENIE: Czy wszystko OK?
# ==========================================

# 1. GitHub Actions tab ‚Üí widaƒá "Deploy React App"
# 2. Kliknij ostatni run
# 3. Widaƒá wszystkie kroki (checkout, setup-node, npm ci, npm run build, etc.)
# 4. Ka≈ºdy krok ma (success) lub (failed)
# 5. Je≈õli ostatni krok (deploy-pages) =  aplikacja live!
# 6. Settings ‚Üí Pages ‚Üí zobacz Environment URL


# ==========================================
# READY TO GO!
# ==========================================

# Teraz ka≈ºdy push na main = automatyczny deploy
# Workflow dzia≈Ça bez Twojego udzia≈Çu!
# GitHub Actions robi ca≈ÇƒÖ robotƒô za Ciebie